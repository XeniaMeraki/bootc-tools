RUN pacman -S base-devel --noconfirm

# Create builder user
RUN useradd -m --shell=/bin/bash build && usermod -L build && \
    echo "build ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers && \
    echo "root ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

# Install AUR packages
USER build
WORKDIR /home/build
RUN --mount=type=tmpfs,dst=/tmp \
    git clone https://aur.archlinux.org/paru-bin.git --single-branch /tmp/paru && \
    cd /tmp/paru && \
    makepkg -si --noconfirm && \
    cd .. && \
    rm -drf paru-bin

# These are example AUR packages, replace as you like. Multi-line or all one line both work for package install.
RUN paru -S --noconfirm \
        aur/steam-devices-git aur/uxplay aur/niri-git aur/noctalia-shell-git aur/matugen-bin aur/input-remapper-bin
        aur/uxplay \
        aur/niri-git \
        aur/noctalia-shell-git \
        aur/matugen-bin \
        aur/input-remapper-bin \

USER root
WORKDIR /

RUN userdel -r build && \
    rm -drf /home/build && \
    sed -i '/build ALL=(ALL) NOPASSWD: ALL/d' /etc/sudoers && \
    sed -i '/root ALL=(ALL) NOPASSWD: ALL/d' /etc/sudoers && \
    rm -rf /home/build && \
    rm -rf \
        /tmp/* \
        /var/cache/pacman/pkg/*

#Script credit @KyleGospo @cyrv6737
